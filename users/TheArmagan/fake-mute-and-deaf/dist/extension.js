(function(h,u,i,o,p){"use strict";function r(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var g=r(h),M=r(p);class _{constructor(){this.patches=[]}add(...e){this.patches.push(...e)}remove(e){let[l]=this.patches.splice(this.patches.indexOf(s=>s==e),1);l()}removeAll(){let e=this.patches.splice(0,this.patches.length);for(let l=0;l<e.length;l++)e[l]()}}var d=new _;let c=!1;async function n(){if(c)return setTimeout(n,125);c=!0;let t=u.NotificationSettingsStore.getState(),e=[];t.disabledSounds.includes("mute")||e.push("mute"),t.disabledSounds.includes("unmute")||e.push("unmute"),t.disabledSounds.push(...e),await u.MediaEngineActions.toggleSelfMute(),await M.default.sleep(100),await u.MediaEngineActions.toggleSelfMute(),t.disabledSounds=t.disabledSounds.filter(l=>!e.includes(l)),c=!1}var b={load(){let t=u.GatewayConnectionStore.getSocket(),e={_selfMute:!1,_selfDeaf:!1,_selfVideo:!1,get selfMute(){return this._selfDeaf||this._selfMute},set selfMute(s){this._selfMute=s},get selfDeaf(){return this._selfDeaf},set selfDeaf(s){this._selfDeaf=s},get selfVideo(){return this._selfVideo},set selfVideo(s){this._selfVideo=s}},l=Object.keys(e);d.add(g.default.before("voiceStateUpdate",t,s=>{for(let f=0;f<l.length;f++){const a=l[f];s[0][a]=e[a]||s[0][a]}return s})),d.add(i.contextMenus.patch("audio-device-context",(s,f)=>{let a=s?.props?.children?.props?.children;!Array.isArray(a)||(a.push(i.contextMenus.build.item({type:"separator"})),f.renderInputDevices?a.push(i.contextMenus.build.item({type:"toggle",label:o.i18n.format("FAKE_MUTE"),checked:e.selfMute,async action(){e.selfMute=!e.selfMute,n()}})):a.push(i.contextMenus.build.item({type:"toggle",label:o.i18n.format("FAKE_DEAF"),checked:e.selfDeaf,async action(){e.selfDeaf=!e.selfDeaf,n()}}),i.contextMenus.build.item({type:"toggle",label:o.i18n.format("FAKE_CAMERA"),checked:e.selfVideo,async action(){e.selfVideo=!e.selfVideo,n()}})))}))},unload(){d.removeAll(),n()}};return b})(acord.patcher,acord.modules.common,acord.ui,acord.extension,acord.utils);
