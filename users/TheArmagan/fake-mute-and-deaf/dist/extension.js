(function(h,o,i,n,p){"use strict";function c(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var M=c(h),g=c(p);class _{constructor(){this.patches=[]}add(...e){this.patches.push(...e)}remove(e){let[a]=this.patches.splice(this.patches.indexOf(s=>s==e),1);a()}removeAll(){let e=this.patches.splice(0,this.patches.length);for(let a=0;a<e.length;a++)e[a]()}}var d=new _;let r=!1;async function u(){if(r)return setTimeout(u,125);r=!0;let t=o.NotificationSettingsStore.getState(),e=[];t.disabledSounds.includes("mute")||e.push("mute"),t.disabledSounds.includes("unmute")||e.push("unmute"),t.disabledSounds.push(...e),await o.MediaEngineActions.toggleSelfMute(),await g.default.sleep(100),await o.MediaEngineActions.toggleSelfMute(),t.disabledSounds=t.disabledSounds.filter(a=>!e.includes(a)),r=!1}var y={load(){let t=o.GatewayConnectionStore.getSocket(),e={_selfMute:!1,_selfDeaf:!1,_selfVideo:!1,get selfMute(){return n.persist.ghost.settings.autoMute?this._selfDeaf||this._selfMute:this._selfMute},set selfMute(s){this._selfMute=s},get selfDeaf(){return this._selfDeaf},set selfDeaf(s){this._selfDeaf=s},get selfVideo(){return this._selfVideo},set selfVideo(s){this._selfVideo=s}},a=["selfDeaf","selfMute","selfVideo"];d.add(M.default.before("voiceStateUpdate",t,s=>{for(let f=0;f<a.length;f++){const l=a[f];s[0][l]=e[l]||s[0][l]}return s})),d.add(i.contextMenus.patch("audio-device-context",(s,f)=>{let l=s?.props?.children?.props?.children;!Array.isArray(l)||(l.push(i.contextMenus.build.item({type:"separator"})),f.renderInputDevices?l.push(i.contextMenus.build.item({type:"toggle",label:n.i18n.format("FAKE_MUTE"),checked:e.selfMute,async action(){e.selfMute=!e.selfMute,u()}})):l.push(i.contextMenus.build.item({type:"toggle",label:n.i18n.format("FAKE_DEAF"),checked:e.selfDeaf,async action(){e.selfDeaf=!e.selfDeaf,u()}}),i.contextMenus.build.item({type:"toggle",label:n.i18n.format("FAKE_CAMERA"),checked:e.selfVideo,async action(){e.selfVideo=!e.selfVideo,u()}})))}))},unload(){d.removeAll(),u()},settings:{data:[{type:"checkbox",name:"Auto Mute",description:"Auto Fake Mute on Fake Deaf.",property:"autoMute",value:!0}]}};return y})(acord.patcher,acord.modules.common,acord.ui,acord.extension,acord.utils);
